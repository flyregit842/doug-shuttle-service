<!DOCTYPE html>
<!--
index.html - Doug Shuttle Service Fixed
ä¿®æ­£è³‡æ–™å‚³é€å•é¡Œï¼Œç¢ºä¿æ‰€æœ‰æ¬„ä½æ­£ç¢ºå¯«å…¥Google Sheets
ç‰ˆæœ¬: v5.4 Fixed | 2025-09-20
-->
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doug Shuttle Service - æ©Ÿå ´æ¥é€é ç´„</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:system-ui,sans-serif;background:#f5f5f5;padding:20px;line-height:1.6}
        .container{max-width:600px;margin:0 auto;background:white;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1)}
        .header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:30px 20px;text-align:center;border-radius:10px 10px 0 0}
        .content{padding:20px}
        .step-indicator{display:flex;justify-content:center;margin-bottom:20px}
        .step-item{width:35px;height:35px;border-radius:50%;background:#e5e7eb;color:#6b7280;display:flex;align-items:center;justify-content:center;font-weight:bold;margin:0 8px}
        .step-item.active{background:#667eea;color:white}
        .step-item.completed{background:#10b981;color:white}
        .step{display:none}
        .step.active{display:block}
        .form-group{margin-bottom:15px}
        label{display:block;margin-bottom:5px;font-weight:600;color:#374151}
        .required::after{content:" *";color:#dc2626}
        input,select,textarea{width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:6px;font-size:16px}
        input:focus,select:focus,textarea:focus{border-color:#667eea;outline:none}
        .service-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:15px 0}
        .service-card{padding:15px;border:2px solid #e5e7eb;border-radius:8px;text-align:center;cursor:pointer;background:white}
        .service-card:hover{border-color:#667eea}
        .service-card.selected{border-color:#667eea;background:#f0f4ff}
        .btn{padding:12px 24px;background:#667eea;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:500;text-decoration:none;display:inline-block}
        .btn:hover:not(:disabled){background:#5a67d8}
        .btn:disabled{opacity:0.6;cursor:not-allowed}
        .btn-outline{background:transparent;border:2px solid #667eea;color:#667eea}
        .btn-outline:hover:not(:disabled){background:#667eea;color:white}
        .btn-group{display:flex;gap:10px;justify-content:center;margin-top:20px}
        .summary{background:#f9fafb;border:1px solid #e5e7eb;border-radius:8px;padding:15px;margin:15px 0}
        .summary-item{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid #e5e7eb}
        .summary-item:last-child{border-bottom:none}
        .toast{position:fixed;top:20px;right:20px;padding:15px;border-radius:6px;z-index:1000;min-width:250px;font-weight:500}
        .toast-success{background:#d1fae5;color:#065f46;border:1px solid #a7f3d0}
        .toast-error{background:#fef2f2;color:#991b1b;border:1px solid #fecaca}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Doug Shuttle Service</h1>
            <p>å°ˆæ¥­æ©Ÿå ´æ¥é€é ç´„ç³»çµ±</p>
        </div>
        
        <div class="content">
            <div class="step-indicator">
                <div class="step-item active" id="step-1">1</div>
                <div class="step-item" id="step-2">2</div>
                <div class="step-item" id="step-3">3</div>
                <div class="step-item" id="step-4">4</div>
            </div>
            
            <!-- æ­¥é©Ÿ1: é¸æ“‡æœå‹™ -->
            <div class="step active" id="step1">
                <h3>é¸æ“‡æœå‹™é …ç›®</h3>
                <div class="service-grid">
                    <div class="service-card" data-service="é€æ©Ÿ">
                        <h4>âœˆï¸ é€æ©Ÿ</h4>
                        <p>å‰å¾€æ©Ÿå ´</p>
                    </div>
                    <div class="service-card" data-service="æ¥æ©Ÿ">
                        <h4>ğŸ  æ¥æ©Ÿ</h4>
                        <p>æ©Ÿå ´å›ä¾†</p>
                    </div>
                    <div class="service-card" data-service="åŒ…è»Š">
                        <h4>ğŸš— åŒ…è»Š</h4>
                        <p>å®¢è£½è¡Œç¨‹</p>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn" onclick="goNext(1)" id="next1" disabled>ä¸‹ä¸€æ­¥</button>
                </div>
            </div>

            <!-- æ­¥é©Ÿ2: åŸºæœ¬è³‡è¨Š -->
            <div class="step" id="step2">
                <h3>åŸºæœ¬è³‡è¨Š</h3>
                <div class="form-group">
                    <label for="phone" class="required">æ‰‹æ©Ÿè™Ÿç¢¼</label>
                    <input type="tel" id="phone" placeholder="0912345678" required>
                </div>
                <div class="form-group">
                    <label for="name" class="required">å§“å</label>
                    <input type="text" id="name" required>
                </div>
                <div class="form-group">
                    <label for="company">å…¬å¸åç¨±</label>
                    <input type="text" id="company">
                </div>
                <div class="form-group">
                    <label for="email">é›»éƒµä¿¡ç®±</label>
                    <input type="email" id="email">
                </div>
                <div class="form-group">
                    <label for="payment" class="required">ä»˜æ¬¾æ–¹å¼</label>
                    <select id="payment" required>
                        <option value="">è«‹é¸æ“‡ä»˜æ¬¾æ–¹å¼</option>
                        <option value="ç¾é‡‘">ç¾é‡‘</option>
                        <option value="ç°½å–®">ç°½å–®</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button class="btn btn-outline" onclick="goPrev(2)">ä¸Šä¸€æ­¥</button>
                    <button class="btn" onclick="goNext(2)">ä¸‹ä¸€æ­¥</button>
                </div>
            </div>

            <!-- æ­¥é©Ÿ3: æ™‚é–“èˆ‡åœ°é» -->
            <div class="step" id="step3">
                <h3>æ™‚é–“èˆ‡åœ°é»</h3>
                <div class="form-group">
                    <label for="date" class="required">æœå‹™æ—¥æœŸ</label>
                    <input type="date" id="date" required>
                </div>
                <div class="form-group">
                    <label for="time" class="required">æ™‚é–“</label>
                    <input type="time" id="time" required>
                </div>
                <div class="form-group" id="flight-group">
                    <label for="flight">èˆªç­ç·¨è™Ÿ</label>
                    <input type="text" id="flight" placeholder="ä¾‹ï¼šCI123">
                </div>
                <div class="form-group">
                    <label for="pickup" class="required">ä¸Šè»Šåœ°é»</label>
                    <input type="text" id="pickup" required>
                </div>
                <div class="form-group">
                    <label for="dropoff" class="required">ä¸‹è»Šåœ°é»</label>
                    <input type="text" id="dropoff" required>
                </div>
                <div class="form-group">
                    <label for="remarks">å‚™è¨»</label>
                    <textarea id="remarks" rows="3"></textarea>
                </div>
                <div class="btn-group">
                    <button class="btn btn-outline" onclick="goPrev(3)">ä¸Šä¸€æ­¥</button>
                    <button class="btn" onclick="goNext(3)">ä¸‹ä¸€æ­¥</button>
                </div>
            </div>

            <!-- æ­¥é©Ÿ4: ç¢ºèª -->
            <div class="step" id="step4">
                <h3>ç¢ºèªé ç´„è³‡è¨Š</h3>
                <div id="summary"></div>
                <div class="btn-group">
                    <button class="btn btn-outline" onclick="goPrev(4)">è¿”å›ä¿®æ”¹</button>
                    <button class="btn" onclick="submitBooking()" id="submitBtn">ç¢ºèªé ç´„</button>
                </div>
            </div>

            <!-- å®Œæˆé é¢ -->
            <div class="step" id="complete" style="text-align:center">
                <h2 style="color:#10b981;margin-bottom:15px">ğŸ‰ é ç´„æˆåŠŸï¼</h2>
                <p>æ‚¨çš„é ç´„å·²å»ºç«‹å®Œæˆ</p>
                <div class="btn-group" style="margin-top:30px">
                    <a href="query.html" class="btn">æŸ¥çœ‹é ç´„</a>
                    <button class="btn btn-outline" onclick="location.reload()">æ–°å¢é ç´„</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let selectedService = '';
        const API_URL = 'https://script.google.com/macros/s/AKfycbwmXgTbydw-G5-WLvE0PMBB8Qbi3Umq3yOl91a7c-Y9iiIlEhHOikLZHjDf5VS0H-4npw/exec';

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ç³»çµ±åˆå§‹åŒ–...');
            
            // è¨­ç½®æœ€å°æ—¥æœŸç‚ºä»Šå¤©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').min = today;
            
            // æœå‹™é¸æ“‡äº‹ä»¶
            document.querySelectorAll('.service-card').forEach(card => {
                card.addEventListener('click', function() {
                    console.log('é¸æ“‡æœå‹™:', this.dataset.service);
                    
                    // æ¸…é™¤é¸æ“‡
                    document.querySelectorAll('.service-card').forEach(c => c.classList.remove('selected'));
                    
                    // è¨­ç½®é¸æ“‡
                    this.classList.add('selected');
                    selectedService = this.dataset.service;
                    
                    // å•Ÿç”¨ä¸‹ä¸€æ­¥
                    document.getElementById('next1').disabled = false;
                    
                    // æ›´æ–°èˆªç­æ¬„ä½é¡¯ç¤º
                    updateFlightField();
                });
            });
            
            console.log('åˆå§‹åŒ–å®Œæˆ');
        });

        function updateFlightField() {
            const flightGroup = document.getElementById('flight-group');
            const flightLabel = flightGroup.querySelector('label');
            const flightInput = document.getElementById('flight');
            
            if (selectedService === 'æ¥æ©Ÿ') {
                flightLabel.textContent = 'èˆªç­ç·¨è™Ÿ *';
                flightLabel.classList.add('required');
                flightInput.required = true;
            } else if (selectedService === 'é€æ©Ÿ') {
                flightLabel.textContent = 'èˆªç­ç·¨è™Ÿ';
                flightLabel.classList.remove('required');
                flightInput.required = false;
            } else {
                flightGroup.style.display = 'none';
            }
        }

        function goNext(step) {
            console.log('ä¸‹ä¸€æ­¥ï¼Œç•¶å‰æ­¥é©Ÿ:', step);
            
            if (!validateStep(step)) return;
            
            if (step === 3) {
                generateSummary();
            }
            
            showStep(step + 1);
        }

        function goPrev(step) {
            console.log('ä¸Šä¸€æ­¥ï¼Œç•¶å‰æ­¥é©Ÿ:', step);
            showStep(step - 1);
        }

        function showStep(stepNum) {
            console.log('é¡¯ç¤ºæ­¥é©Ÿ:', stepNum);
            
            // éš±è—æ‰€æœ‰æ­¥é©Ÿ
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            
            // é¡¯ç¤ºç›®æ¨™æ­¥é©Ÿ
            document.getElementById('step' + stepNum).classList.add('active');
            
            // æ›´æ–°æŒ‡ç¤ºå™¨
            updateIndicator(stepNum);
            currentStep = stepNum;
        }

        function updateIndicator(step) {
            for (let i = 1; i <= 4; i++) {
                const indicator = document.getElementById('step-' + i);
                indicator.classList.remove('active', 'completed');
                
                if (i < step) {
                    indicator.classList.add('completed');
                } else if (i === step) {
                    indicator.classList.add('active');
                }
            }
        }

        function validateStep(step) {
            console.log('é©—è­‰æ­¥é©Ÿ:', step);
            
            switch(step) {
                case 1:
                    if (!selectedService) {
                        showToast('è«‹é¸æ“‡æœå‹™é …ç›®', 'error');
                        return false;
                    }
                    break;
                    
                case 2:
                    const phone = document.getElementById('phone').value.trim();
                    const name = document.getElementById('name').value.trim();
                    const payment = document.getElementById('payment').value;
                    
                    if (!phone || phone.length < 10) {
                        showToast('è«‹è¼¸å…¥æ­£ç¢ºçš„æ‰‹æ©Ÿè™Ÿç¢¼', 'error');
                        return false;
                    }
                    if (!name) {
                        showToast('è«‹è¼¸å…¥å§“å', 'error');
                        return false;
                    }
                    if (!payment) {
                        showToast('è«‹é¸æ“‡ä»˜æ¬¾æ–¹å¼', 'error');
                        return false;
                    }
                    break;
                    
                case 3:
                    const date = document.getElementById('date').value;
                    const time = document.getElementById('time').value;
                    const pickup = document.getElementById('pickup').value.trim();
                    const dropoff = document.getElementById('dropoff').value.trim();
                    const flight = document.getElementById('flight').value.trim();
                    
                    if (!date) {
                        showToast('è«‹é¸æ“‡æœå‹™æ—¥æœŸ', 'error');
                        return false;
                    }
                    if (!time) {
                        showToast('è«‹é¸æ“‡æœå‹™æ™‚é–“', 'error');
                        return false;
                    }
                    if (!pickup) {
                        showToast('è«‹è¼¸å…¥ä¸Šè»Šåœ°é»', 'error');
                        return false;
                    }
                    if (!dropoff) {
                        showToast('è«‹è¼¸å…¥ä¸‹è»Šåœ°é»', 'error');
                        return false;
                    }
                    if (selectedService === 'æ¥æ©Ÿ' && !flight) {
                        showToast('æ¥æ©Ÿæœå‹™éœ€è¦å¡«å¯«èˆªç­ç·¨è™Ÿ', 'error');
                        return false;
                    }
                    break;
            }
            
            return true;
        }

        function generateSummary() {
            console.log('ç”Ÿæˆæ‘˜è¦');
            const summaryDiv = document.getElementById('summary');
            
            const data = {
                æœå‹™é¡å‹: selectedService,
                å§“å: document.getElementById('name').value,
                æ‰‹æ©Ÿ: document.getElementById('phone').value,
                å…¬å¸: document.getElementById('company').value || '-',
                æ—¥æœŸ: document.getElementById('date').value,
                æ™‚é–“: document.getElementById('time').value,
                èˆªç­: document.getElementById('flight').value || '-',
                ä¸Šè»Šé»: document.getElementById('pickup').value,
                ä¸‹è»Šé»: document.getElementById('dropoff').value,
                ä»˜æ¬¾: document.getElementById('payment').value,
                å‚™è¨»: document.getElementById('remarks').value || '-'
            };
            
            let html = '<div class="summary">';
            for (const [key, value] of Object.entries(data)) {
                html += `<div class="summary-item"><span>${key}:</span><span>${value}</span></div>`;
            }
            html += '</div>';
            
            summaryDiv.innerHTML = html;
        }

        async function submitBooking() {
            console.log('=== é–‹å§‹æäº¤é ç´„ ===');
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'æäº¤ä¸­...';
            
            try {
                // æº–å‚™è³‡æ–™ - ç¢ºä¿æ¬„ä½åç¨±å®Œå…¨å°æ‡‰å¾Œç«¯
                const bookingData = {
                    'æœå‹™é …ç›®': selectedService,
                    'æ‰‹æ©Ÿè™Ÿç¢¼': document.getElementById('phone').value.replace(/\D/g, ''),
                    'å§“å': document.getElementById('name').value.trim(),
                    'å…¬å¸åç¨±': document.getElementById('company').value.trim(),
                    'éƒ¨é–€': '',
                    'æ—¥æœŸ': document.getElementById('date').value,
                    'æ™‚é–“': document.getElementById('time').value,
                    'èˆªç­ç·¨è™Ÿ': document.getElementById('flight').value.trim(),
                    'ä¸Šè»Šé»': document.getElementById('pickup').value.trim(),
                    'ä¸­åœé»': '',
                    'ä¸‹è»Šé»': document.getElementById('dropoff').value.trim(),
                    'å‚™è¨»': document.getElementById('remarks').value.trim(),
                    'è²»ç”¨æ”¯ä»˜': document.getElementById('payment').value,
                    'é›»éƒµä¿¡ç®±': document.getElementById('email').value.trim(),
                    'ä»£ç†ä¿¡ç®±': '',
                    'æˆæœ¬ä¸­å¿ƒ': ''
                };
                
                console.log('æº–å‚™æäº¤çš„è³‡æ–™:', bookingData);
                
                // å»ºç«‹è«‹æ±‚
                const formBody = Object.keys(bookingData)
                    .map(key => encodeURIComponent(key) + '=' + encodeURIComponent(bookingData[key] || ''))
                    .join('&');
                
                const requestBody = 'action=createBooking&' + formBody;
                console.log('è«‹æ±‚é«”:', requestBody);
                
                // ç™¼é€è«‹æ±‚
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: requestBody
                });
                
                console.log('å›æ‡‰ç‹€æ…‹:', response.status);
                
                if (!response.ok) {
                    throw new Error('ç¶²çµ¡éŒ¯èª¤: ' + response.status);
                }
                
                const result = await response.json();
                console.log('APIå›æ‡‰:', result);
                
                if (result.success) {
                    console.log('æäº¤æˆåŠŸï¼');
                    showStep(5); // é¡¯ç¤ºå®Œæˆé é¢
                    showToast('é ç´„å»ºç«‹æˆåŠŸï¼', 'success');
                } else {
                    throw new Error(result.message || 'æäº¤å¤±æ•—');
                }
                
            } catch (error) {
                console.error('æäº¤éŒ¯èª¤:', error);
                showToast('æäº¤å¤±æ•—: ' + error.message, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'ç¢ºèªé ç´„';
            }
        }

        function showToast(message, type) {
            // ç§»é™¤ç¾æœ‰toast
            const existing = document.querySelector('.toast');
            if (existing) existing.remove();
            
            // å‰µå»ºæ–°toast
            const toast = document.createElement('div');
            toast.className = 'toast toast-' + type;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // 3ç§’å¾Œç§»é™¤
            setTimeout(() => {
                if (toast.parentNode) toast.remove();
            }, 3000);
        }

        // æ­¥é©Ÿ5é¡¯ç¤ºå®Œæˆé é¢
        function showStep(stepNum) {
            console.log('é¡¯ç¤ºæ­¥é©Ÿ:', stepNum);
            
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            
            if (stepNum === 5) {
                document.getElementById('complete').classList.add('active');
            } else {
                document.getElementById('step' + stepNum).classList.add('active');
                updateIndicator(stepNum);
            }
            
            currentStep = stepNum;
        }
    </script>
</body>
</html>