<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ©Ÿå ´æ¥é€é ç´„ç³»çµ±</title>
    <meta name="description" content="å°ˆæ¥­çš„æ©Ÿå ´æ¥é€é ç´„æœå‹™ï¼Œæä¾›åŒ—åŒ—åŸºæ¡ƒé€æ©Ÿã€æ¥æ©ŸåŠå…¶ä»–è¡Œç¨‹æ¥é€">
    <meta name="author" content="æ©Ÿå ´æ¥é€æœå‹™">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .header {
            background: white;
            color: #333;
            padding: 40px 24px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #2c3e50;
        }

        .header p {
            font-size: 16px;
            color: #6c757d;
        }

        .service-indicator {
            background: #2c3e50;
            color: white;
            padding: 12px 24px;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
            display: none;
        }

        .service-indicator.show {
            display: block;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            padding: 20px 24px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .progress-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 12px;
            right: -50%;
            width: 100%;
            height: 2px;
            background: #e9ecef;
            z-index: 1;
        }

        .progress-step.active::after {
            background: #2c3e50;
        }

        .step-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #e9ecef;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            margin: 0 auto 8px;
            position: relative;
            z-index: 2;
        }

        .progress-step.active .step-number {
            background: #2c3e50;
            color: white;
        }

        .step-label {
            font-size: 13px;
            color: #6c757d;
            font-weight: 500;
        }

        .progress-step.active .step-label {
            color: #2c3e50;
        }

        .content {
            padding: 32px 24px;
        }

        .page {
            display: none;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease-in-out;
        }

        .page.active {
            display: block;
            opacity: 1;
            transform: translateX(0);
        }

        .service-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            margin-bottom: 32px;
        }

        .service-card {
            border: 2px solid #e9ecef;
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            position: relative;
        }

        .service-card:hover {
            border-color: #2c3e50;
            box-shadow: 0 8px 16px rgba(44, 62, 80, 0.1);
            transform: translateY(-2px);
        }

        .service-card.selected {
            border-color: #2c3e50;
            background: #f8f9fa;
            box-shadow: 0 8px 16px rgba(44, 62, 80, 0.15);
            transform: scale(1.02);
        }

        .service-card.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 15px;
            right: 15px;
            background: #28a745;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .service-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .service-desc {
            font-size: 16px;
            color: #6c757d;
            line-height: 1.5;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .form-input {
            width: 100%;
            padding: 18px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 17px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: #2c3e50;
            box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.1);
        }

        .form-input.auto-filled {
            background-color: #e8f5e8;
            border-color: #28a745;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-textarea {
            width: 100%;
            padding: 18px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 17px;
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .time-input {
            position: relative;
        }

        .time-display {
            width: 100%;
            padding: 18px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 17px;
            background: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .time-display:hover {
            border-color: #2c3e50;
        }

        .time-picker {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #2c3e50;
            border-radius: 12px;
            z-index: 1000;
            padding: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            display: none;
        }

        .time-picker.show {
            display: block;
        }

        .time-row {
            display: flex;
            gap: 16px;
            align-items: center;
            margin-bottom: 16px;
        }

        .time-select {
            flex: 1;
            padding: 12px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
        }

        .user-history {
            margin-top: 16px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            border-left: 4px solid #2c3e50;
        }

        .history-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 14px;
        }

        .history-item {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
        }

        .history-item:hover {
            background: #f8f9fa;
            border-color: #2c3e50;
        }

        .history-item:last-child {
            margin-bottom: 0;
        }

        .history-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-service {
            font-weight: 600;
            color: #2c3e50;
            font-size: 15px;
        }

        .history-date {
            font-size: 13px;
            color: #6c757d;
        }

        .loading-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 18px;
            color: #6c757d;
            font-size: 15px;
        }

        .loading-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #e9ecef;
            border-top: 2px solid #2c3e50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .airport-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 8px;
        }

        .airport-option {
            cursor: pointer;
        }

        .airport-option input[type="radio"] {
            display: none;
        }

        .airport-card {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            transition: all 0.3s ease;
            background: white;
        }

        .airport-option:hover .airport-card {
            border-color: #2c3e50;
            box-shadow: 0 4px 8px rgba(44, 62, 80, 0.1);
        }

        .airport-option input[type="radio"]:checked + .airport-card {
            border-color: #2c3e50;
            background: #f8f9fa;
            box-shadow: 0 4px 12px rgba(44, 62, 80, 0.15);
        }

        .airport-name {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
        }

        .airport-option input[type="radio"]:checked + .airport-card .airport-name {
            color: #2c3e50;
        }

        .payment-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 8px;
        }

        .payment-option {
            cursor: pointer;
        }

        .payment-option input[type="radio"] {
            display: none;
        }

        .payment-card {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            transition: all 0.3s ease;
            background: white;
        }

        .payment-option:hover .payment-card {
            border-color: #2c3e50;
            box-shadow: 0 4px 8px rgba(44, 62, 80, 0.1);
        }

        .payment-option input[type="radio"]:checked + .payment-card {
            border-color: #2c3e50;
            background: #f8f9fa;
            box-shadow: 0 4px 12px rgba(44, 62, 80, 0.15);
        }

        .payment-name {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
        }

        .payment-option input[type="radio"]:checked + .payment-card .payment-name {
            color: #2c3e50;
        }

        .btn {
            padding: 18px 28px;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: #2c3e50;
            color: white;
        }

        .btn-primary:hover {
            background: #34495e;
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(44, 62, 80, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #2c3e50;
            color: #2c3e50;
        }

        .btn-outline:hover {
            background: #2c3e50;
            color: white;
        }

        .btn-danger {
            background: transparent;
            border: 2px solid #dc3545;
            color: #dc3545;
        }

        .btn-danger:hover {
            background: #dc3545;
            color: white;
        }

        .btn-warning {
            background: transparent;
            border: 2px solid #ffc107;
            color: #856404;
        }

        .btn-warning:hover {
            background: #ffc107;
            color: #856404;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 12px;
            margin-top: 32px;
        }

        .btn-group-single {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 32px;
        }

        .btn-group-double {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 32px;
        }

        .btn-group-triple {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-top: 32px;
        }

        .action-bar {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 16px 24px;
            border-top: 1px solid #e9ecef;
            margin: 0 -24px -32px -24px;
        }

        .summary-card {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            border-left: 4px solid #2c3e50;
        }

        .summary-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 18px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-size: 15px;
            color: #6c757d;
            font-weight: 500;
        }

        .summary-value {
            font-size: 16px;
            color: #2c3e50;
            font-weight: 600;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
            background: #28a745;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: white;
        }

        .success-message {
            text-align: center;
            margin-bottom: 32px;
        }

        .success-title {
            font-size: 26px;
            font-weight: 600;
            color: #28a745;
            margin-bottom: 12px;
        }

        .success-desc {
            font-size: 16px;
            color: #6c757d;
            line-height: 1.5;
        }

        .booking-id {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 24px;
        }

        .booking-id-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 4px;
        }

        .booking-id-value {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            letter-spacing: 1px;
        }

        .hidden {
            display: none !important;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 8px;
            font-size: 14px;
            border-left: 4px solid #dc3545;
        }

        .exit-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .exit-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .exit-dialog {
            background: white;
            border-radius: 16px;
            padding: 32px 24px;
            max-width: 400px;
            margin: 20px;
            text-align: center;
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .exit-overlay.show .exit-dialog {
            transform: scale(1);
        }

        .exit-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 16px;
        }

        .exit-message {
            font-size: 16px;
            color: #6c757d;
            margin-bottom: 24px;
        }

        @media (max-width: 480px) {
            .container {
                margin: 10px;
                border-radius: 16px;
            }

            .header {
                padding: 24px 16px;
            }

            .content {
                padding: 24px 16px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .btn-group {
                grid-template-columns: 1fr;
            }

            .btn-group-triple {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>æ©Ÿå ´æ¥é€é ç´„</h1>
            <p>å°ˆæ¥­å•†å‹™æ¥é€æœå‹™</p>
        </div>

        <!-- æœå‹™é¡å‹é¡¯ç¤ºå™¨ -->
        <div class="service-indicator" id="serviceIndicator"></div>

        <div class="progress-bar">
            <div class="progress-step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label">é¸æ“‡æœå‹™</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label">å¡«å¯«è³‡æ–™</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-label">ç¢ºèªé ç´„</div>
            </div>
            <div class="progress-step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-label">å®Œæˆ</div>
            </div>
        </div>

        <div class="content">
            <!-- ç¬¬ä¸€é ï¼šé¸æ“‡æœå‹™ -->
            <div class="page active" data-page="1">
                <div class="service-grid">
                    <div class="service-card" data-service="åŒ—åŒ—åŸºæ¡ƒé€æ©Ÿ">
                        <div class="service-title">åŒ—åŒ—åŸºæ¡ƒé€æ©Ÿ</div>
                        <div class="service-desc">å¾ä½å®¶æˆ–æŒ‡å®šåœ°é»é€è‡³æ¡ƒåœ’ã€æ¾å±±æ©Ÿå ´</div>
                    </div>
                    <div class="service-card" data-service="åŒ—åŒ—åŸºæ¡ƒæ¥æ©Ÿ">
                        <div class="service-title">åŒ—åŒ—åŸºæ¡ƒæ¥æ©Ÿ</div>
                        <div class="service-desc">å¾æ¡ƒåœ’ã€æ¾å±±æ©Ÿå ´æ¥é€è‡³ä½å®¶æˆ–æŒ‡å®šåœ°é»</div>
                    </div>
                    <div class="service-card" data-service="å…¶ä»–è¡Œç¨‹æ¥é€">
                        <div class="service-title">å…¶ä»–è¡Œç¨‹æ¥é€</div>
                        <div class="service-desc">é«˜éµã€åŒ…è»Šã€å•†å‹™ç­‰å„ç¨®æ¥é€æœå‹™</div>
                    </div>
                </div>
                
                <div class="action-bar">
                    <div class="btn-group-double">
                        <button class="btn btn-outline" onclick="goToQuery()">æŸ¥è©¢é ç´„</button>
                        <button class="btn btn-danger" onclick="showExitDialog()">é›¢é–‹</button>
                    </div>
                </div>
            </div>

            <!-- ç¬¬äºŒé ï¼šå¡«å¯«è³‡æ–™ -->
            <div class="page" data-page="2">
                <div class="form-group">
                    <label class="form-label">æ‰‹æ©Ÿè™Ÿç¢¼ *</label>
                    <input type="tel" class="form-input" id="phone" placeholder="è«‹è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼" required>
                    <div id="phoneError" class="error-message hidden">è«‹è¼¸å…¥æœ‰æ•ˆçš„æ‰‹æ©Ÿè™Ÿç¢¼</div>
                    <div id="loadingIndicator" class="loading-indicator hidden">
                        <div class="loading-spinner"></div>
                        <span>æŸ¥è©¢æ­·å²è³‡æ–™ä¸­...</span>
                    </div>
                    <div id="userHistory" class="user-history hidden">
                        <div class="history-title">é¸æ“‡æ­·å²è³‡æ–™è‡ªå‹•å¸¶å…¥</div>
                        <div id="historyList"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">å…¬å¸åç¨± *</label>
                    <input type="text" class="form-input" id="company" placeholder="è«‹è¼¸å…¥å…¬å¸åç¨±" required>
                </div>

                <div class="form-group">
                    <label class="form-label">éƒ¨é–€</label>
                    <input type="text" class="form-input" id="department" placeholder="è«‹è¼¸å…¥éƒ¨é–€ï¼ˆé¸å¡«ï¼‰">
                </div>

                <div class="form-group">
                    <label class="form-label">è¯çµ¡äººå§“å *</label>
                    <input type="text" class="form-input" id="name" placeholder="è«‹è¼¸å…¥è¯çµ¡äººå§“å" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ“§ é›»å­éƒµä»¶ (é¸å¡«)</label>
                    <input type="email" id="email" name="email" placeholder="example@gmail.com" class="form-control">
                    <small style="font-size: 12px; color: #6b7280; margin-top: 4px; display: block;">å¡«å¯«å¾Œå°‡æ”¶åˆ°é ç´„ç¢ºèªå’Œæé†’éƒµä»¶</small>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">é ç´„æ—¥æœŸ *</label>
                        <input type="date" class="form-input" id="date" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">é ç´„æ™‚é–“ *</label>
                        <div class="time-input">
                            <div class="time-display" id="timeDisplay" onclick="toggleTimePicker()">
                                <span id="timeValue">è«‹é¸æ“‡æ™‚é–“</span>
                                <span>â–¼</span>
                            </div>
                            <div class="time-picker" id="timePicker">
                                <div class="time-row">
                                    <select class="time-select" id="hourSelect">
                                        <option value="">æ™‚</option>
                                    </select>
                                    <span>:</span>
                                    <select class="time-select" id="minuteSelect">
                                        <option value="">åˆ†</option>
                                    </select>
                                </div>
                                <button class="btn btn-primary" onclick="setTime()">ç¢ºå®š</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group" id="airportField">
                    <label class="form-label">æ©Ÿå ´é¸æ“‡ *</label>
                    <div class="airport-options">
                        <label class="airport-option">
                            <input type="radio" name="airport" value="æ¡ƒåœ’æ©Ÿå ´" checked>
                            <div class="airport-card">
                                <div class="airport-name">æ¡ƒåœ’æ©Ÿå ´</div>
                            </div>
                        </label>
                        <label class="airport-option">
                            <input type="radio" name="airport" value="æ¾å±±æ©Ÿå ´">
                            <div class="airport-card">
                                <div class="airport-name">æ¾å±±æ©Ÿå ´</div>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="form-group" id="flightField">
                    <label class="form-label">èˆªç­è³‡è¨Š</label>
                    <input type="text" class="form-input" id="flight" placeholder="è«‹è¼¸å…¥èˆªç­è™Ÿç¢¼ï¼ˆé¸å¡«ï¼‰">
                </div>

                <div class="form-group" id="pickupField">
                    <label class="form-label">ä¸Šè»Šåœ°é» *</label>
                    <input type="text" class="form-input" id="pickup" placeholder="è«‹è¼¸å…¥ä¸Šè»Šåœ°é»" required>
                </div>

                <div class="form-group" id="dropoffField">
                    <label class="form-label">ä¸‹è»Šåœ°é» *</label>
                    <input type="text" class="form-input" id="dropoff" placeholder="è«‹è¼¸å…¥ä¸‹è»Šåœ°é»" required>
                </div>

                <div class="form-group">
                    <label class="form-label">å‚™è¨»</label>
                    <textarea class="form-textarea" id="remarks" placeholder="è«‹èªªæ˜è¡Œç¨‹è¨ˆç•«ã€ç‰¹æ®Šéœ€æ±‚æˆ–å…¶ä»–å‚™è¨»ï¼ˆé¸å¡«ï¼‰"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">è²»ç”¨æ”¯ä»˜æ–¹å¼ *</label>
                    <div class="payment-options">
                        <label class="payment-option">
                            <input type="radio" name="payment" value="ç°½å–®" required>
                            <div class="payment-card">
                                <div class="payment-name">å…¬å¸ç°½å–®</div>
                            </div>
                        </label>
                        <label class="payment-option">
                            <input type="radio" name="payment" value="ç¾é‡‘" required>
                            <div class="payment-card">
                                <div class="payment-name">ç¾é‡‘ä»˜æ¬¾</div>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="action-bar">
                    <div class="btn-group-triple">
                        <button class="btn btn-warning" onclick="restartBooking()">é‡æ–°é–‹å§‹</button>
                        <button class="btn btn-outline" onclick="prevPage()">ä¸Šä¸€æ­¥</button>
                        <button class="btn btn-primary" onclick="nextPage()">ä¸‹ä¸€æ­¥</button>
                    </div>
                </div>
            </div>

            <!-- ç¬¬ä¸‰é ï¼šç¢ºèªé ç´„ -->
            <div class="page" data-page="3">
                <div class="summary-card">
                    <div class="summary-title">é ç´„è³‡è¨Šç¢ºèª</div>
                    <div id="summaryContent">
                        <!-- å‹•æ…‹ç”Ÿæˆé ç´„æ‘˜è¦ -->
                    </div>
                </div>
                
                <div class="action-bar">
                    <div class="btn-group-triple">
                        <button class="btn btn-warning" onclick="restartBooking()">é‡æ–°é–‹å§‹</button>
                        <button class="btn btn-outline" onclick="prevPage()">ä¿®æ”¹è³‡æ–™</button>
                        <button class="btn btn-primary" onclick="submitBooking()">ç¢ºèªé ç´„</button>
                    </div>
                </div>
            </div>

            <!-- ç¬¬å››é ï¼šå®Œæˆ -->
            <div class="page" data-page="4">
                <div class="success-icon">âœ“</div>
                <div class="success-message">
                    <div class="success-title">é ç´„æˆåŠŸï¼</div>
                    <div class="success-desc">æ‚¨çš„é ç´„å·²æˆåŠŸæäº¤ï¼Œæˆ‘å€‘å°‡ç›¡å¿«èˆ‡æ‚¨è¯ç¹«ç¢ºèªè©³æƒ…ã€‚</div>
                </div>
                <div class="booking-id">
                    <div class="booking-id-label">æŸ¥è©¢è«‹æä¾›æ‰‹æ©Ÿè™Ÿç¢¼</div>
                    <div class="booking-id-value" id="bookingIdDisplay"></div>
                </div>
                
                <div class="action-bar">
                    <div class="btn-group-triple">
                        <button class="btn btn-outline" onclick="goToQuery()">æŸ¥è©¢é ç´„</button>
                        <button class="btn btn-primary" onclick="newBooking()">æ–°å¢é ç´„</button>
                        <button class="btn btn-danger" onclick="showExitDialog()">é›¢é–‹</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é›¢é–‹ç¢ºèªå°è©±æ¡† -->
    <div class="exit-overlay" id="exitOverlay">
        <div class="exit-dialog">
            <div class="exit-title">ç¢ºèªé›¢é–‹</div>
            <div class="exit-message">æ‚¨ç¢ºå®šè¦é›¢é–‹é ç´„ç³»çµ±å—ï¼Ÿ</div>
            <div class="btn-group">
                <button class="btn btn-outline" onclick="hideExitDialog()">å–æ¶ˆ</button>
                <button class="btn btn-danger" onclick="exitSystem()">ç¢ºèªé›¢é–‹</button>
            </div>
        </div>
    </div>
// ==========================================
// åœ¨ index.html çš„ JavaScript å€åŸŸåŠ å…¥ä»¥ä¸‹ä»£ç¢¼
// ==========================================

// API è¨­å®š
const API_URL = 'https://script.google.com/macros/s/AKfycbwmXgTbydw-G5-WLvE0PMBB8Qbi3Umq3yOl91a7c-Y9iiIlEhHOikLZHjDf5VS0H-4npw/exec';

// é é¢è¼‰å…¥å®Œæˆå¾Œè¨­å®šæ‰‹æ©Ÿè™Ÿç¢¼è‡ªå‹•å¸¶å…¥åŠŸèƒ½
document.addEventListener('DOMContentLoaded', function() {
    setupPhoneAutofill();
});

// å¦‚æœé é¢å·²ç¶“è¼‰å…¥å®Œæˆ
if (document.readyState !== 'loading') {
    setupPhoneAutofill();
}

// è¨­å®šæ‰‹æ©Ÿè™Ÿç¢¼è‡ªå‹•å¸¶å…¥åŠŸèƒ½
function setupPhoneAutofill() {
    const phoneInput = document.getElementById('phone');
    if (phoneInput) {
        // ç•¶æ‰‹æ©Ÿè¼¸å…¥æ¡†å¤±å»ç„¦é»æ™‚è§¸ç™¼
        phoneInput.addEventListener('blur', function() {
            const phone = this.value.trim();
            if (phone && phone.length >= 9) {
                loadUserData(phone);
            }
        });
        
        // ç•¶è¼¸å…¥é”åˆ°10ä½æ•¸æ™‚è‡ªå‹•è§¸ç™¼
        phoneInput.addEventListener('input', function() {
            const phone = this.value.trim().replace(/\D/g, ''); // åªä¿ç•™æ•¸å­—
            if (phone.length === 10) {
                loadUserData(phone);
            }
        });
    }
}

// è¼‰å…¥ç”¨æˆ¶è³‡æ–™
async function loadUserData(phone) {
    try {
        showLoadingIndicator();
        
        const formData = new URLSearchParams();
        formData.append('action', 'getUserDataByPhone');
        formData.append('phone', phone);

        console.log('æ­£åœ¨æŸ¥è©¢æ‰‹æ©Ÿè™Ÿç¢¼:', phone);

        const response = await fetch(API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: formData
        });

        const result = await response.json();
        
        hideLoadingIndicator();
        
        console.log('æŸ¥è©¢çµæœ:', result);
        
        if (result.success && result.data) {
            // è‡ªå‹•å¡«å…¥ç”¨æˆ¶è³‡æ–™
            fillUserData(result.data);
            showNotification('âœ… å·²è‡ªå‹•å¸¶å…¥æ‚¨çš„è³‡æ–™', 'success');
        } else {
            console.log('æœªæ‰¾åˆ°ç”¨æˆ¶è³‡æ–™ï¼Œéœ€è¦æ‰‹å‹•å¡«å¯«');
            // ä¸é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ï¼Œéœé»˜è™•ç†
        }
        
    } catch (error) {
        hideLoadingIndicator();
        console.error('è¼‰å…¥ç”¨æˆ¶è³‡æ–™å¤±æ•—:', error);
        // ä¸é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯çµ¦ç”¨æˆ¶ï¼Œéœé»˜è™•ç†
    }
}

// å¡«å…¥ç”¨æˆ¶è³‡æ–™
function fillUserData(userData) {
    console.log('é–‹å§‹å¡«å…¥ç”¨æˆ¶è³‡æ–™:', userData);
    
    // å¡«å…¥å§“å
    const nameInput = document.getElementById('name');
    if (nameInput && userData.name) {
        nameInput.value = userData.name;
        addFilledEffect(nameInput);
    }

    // å¡«å…¥å…¬å¸
    const companyInput = document.getElementById('company');
    if (companyInput && userData.company) {
        companyInput.value = userData.company;
        addFilledEffect(companyInput);
    }

    // å¡«å…¥éƒ¨é–€
    const departmentInput = document.getElementById('department');
    if (departmentInput && userData.department) {
        departmentInput.value = userData.department;
        addFilledEffect(departmentInput);
    }

    // å¡«å…¥ email
    const emailInput = document.getElementById('email');
    if (emailInput && userData.email) {
        emailInput.value = userData.email;
        addFilledEffect(emailInput);
    }
}

// æ·»åŠ å¡«å…¥æ•ˆæœ
function addFilledEffect(inputElement) {
    if (inputElement && inputElement.value) {
        inputElement.style.backgroundColor = '#e8f5e8';
        inputElement.style.transition = 'background-color 0.3s ease';
        
        setTimeout(() => {
            inputElement.style.backgroundColor = '';
        }, 2000);
    }
}

// é¡¯ç¤ºè¼‰å…¥æŒ‡ç¤ºå™¨
function showLoadingIndicator() {
    const phoneInput = document.getElementById('phone');
    if (phoneInput) {
        phoneInput.style.backgroundImage = 'url("data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'20\' height=\'20\' viewBox=\'0 0 24 24\' fill=\'none\' stroke=\'%23666\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'%3E%3Cpath d=\'M21 12a9 9 0 11-6.219-8.56\'/%3E%3C/svg%3E")';
        phoneInput.style.backgroundRepeat = 'no-repeat';
        phoneInput.style.backgroundPosition = 'right 10px center';
        phoneInput.style.backgroundSize = '20px 20px';
        phoneInput.style.animation = 'spin 1s linear infinite';
        
        // æ·»åŠ æ—‹è½‰å‹•ç•«çš„ CSS
        if (!document.getElementById('spin-animation')) {
            const style = document.createElement('style');
            style.id = 'spin-animation';
            style.textContent = `
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
        }
    }
}

// éš±è—è¼‰å…¥æŒ‡ç¤ºå™¨
function hideLoadingIndicator() {
    const phoneInput = document.getElementById('phone');
    if (phoneInput) {
        phoneInput.style.backgroundImage = '';
        phoneInput.style.animation = '';
    }
}

// é¡¯ç¤ºé€šçŸ¥
function showNotification(message, type = 'info') {
    // ç§»é™¤ç¾æœ‰é€šçŸ¥
    const existingNotification = document.querySelector('.auto-notification');
    if (existingNotification) {
        existingNotification.remove();
    }
    
    // å‰µå»ºé€šçŸ¥å…ƒç´ 
    const notification = document.createElement('div');
    notification.className = `auto-notification ${type}`;
    notification.textContent = message;
    
    // è¨­å®šæ¨£å¼
    const styles = {
        position: 'fixed',
        top: '20px',
        right: '20px',
        padding: '12px 20px',
        borderRadius: '6px',
        color: 'white',
        fontWeight: '500',
        zIndex: '10000',
        transition: 'all 0.3s ease',
        fontSize: '14px',
        maxWidth: '300px',
        boxShadow: '0 4px 12px rgba(0,0,0,0.15)'
    };
    
    // è¨­å®šèƒŒæ™¯é¡è‰²
    if (type === 'success') {
        styles.backgroundColor = '#10b981';
    } else if (type === 'error') {
        styles.backgroundColor = '#ef4444';
    } else {
        styles.backgroundColor = '#3b82f6';
    }
    
    // æ‡‰ç”¨æ¨£å¼
    Object.assign(notification.style, styles);
    
    document.body.appendChild(notification);

    // 3ç§’å¾Œè‡ªå‹•ç§»é™¤
    setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// æ ¼å¼åŒ–æ‰‹æ©Ÿè™Ÿç¢¼è¼¸å…¥
function formatPhoneInput() {
    const phoneInput = document.getElementById('phone');
    if (phoneInput) {
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, ''); // åªä¿ç•™æ•¸å­—
            
            // é™åˆ¶æœ€å¤§é•·åº¦ç‚º10ä½
            if (value.length > 10) {
                value = value.slice(0, 10);
            }
            
            // æ ¼å¼åŒ–é¡¯ç¤º (ä¾‹å¦‚: 0912-345-678)
            if (value.length >= 4) {
                if (value.length <= 7) {
                    value = value.replace(/(\d{4})(\d+)/, '$1-$2');
                } else {
                    value = value.replace(/(\d{4})(\d{3})(\d+)/, '$1-$2-$3');
                }
            }
            
            e.target.value = value;
        });
    }
}

// åœ¨é é¢è¼‰å…¥æ™‚ä¹Ÿè¨­å®šæ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼åŒ–
document.addEventListener('DOMContentLoaded', function() {
    formatPhoneInput();
});

// é©—è­‰å‡½æ•¸
function validatePhoneNumber(phone) {
    const cleanPhone = phone.replace(/\D/g, '');
    return cleanPhone.length === 10 && /^09/.test(cleanPhone);
}

function validateEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

// è¡¨å–®æäº¤å‰é©—è­‰
function validateForm() {
    const phoneInput = document.getElementById('phone');
    const emailInput = document.getElementById('email');
    
    if (phoneInput) {
        const phone = phoneInput.value.replace(/\D/g, '');
        if (!validatePhoneNumber(phone)) {
            showNotification('è«‹è¼¸å…¥æ­£ç¢ºçš„æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼ (10ä½æ•¸å­—)', 'error');
            phoneInput.focus();
            return false;
        }
    }
    
    if (emailInput && emailInput.value) {
        if (!validateEmail(emailInput.value)) {
            showNotification('è«‹è¼¸å…¥æ­£ç¢ºçš„éƒµç®±æ ¼å¼', 'error');
            emailInput.focus();
            return false;
        }
    }
    
    return true;
}
    <script>
        // GitHub Pages å°ˆç”¨é…ç½®
        const CONFIG = {
            API_URL: 'https://script.google.com/macros/s/AKfycbwmXgTbydw-G5-WLvE0PMBB8Qbi3Umq3yOl91a7c-Y9iiIlEhHOikLZHjDf5VS0H-4npw/exec',
            DEMO_MODE: false
        };

        let currentPage = 1;
        let selectedService = '';
        let formData = {};
        let phoneQueryTimeout = null;
        let userDataCache = {}; // å¿«å–ç”¨æˆ¶è³‡æ–™

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setupServiceSelection();
            setupPhoneInput();
            setupTimePicker();
            setMinDate();
            
            // ç¢ºä¿æ‰€æœ‰æ¬„ä½åˆå§‹ç‹€æ…‹æ­£ç¢º
            const airportField = document.getElementById('airportField');
            const flightField = document.getElementById('flightField');
            if (airportField) airportField.style.display = 'none';
            if (flightField) flightField.style.display = 'none';
            
            // è¨­ç½®é»æ“Šå¤–éƒ¨é—œé–‰æ™‚é–“é¸æ“‡å™¨
            document.addEventListener('click', function(e) {
                const timePicker = document.getElementById('timePicker');
                const timeDisplay = document.getElementById('timeDisplay');
                if (!timePicker.contains(e.target) && !timeDisplay.contains(e.target)) {
                    timePicker.classList.remove('show');
                }
            });
        });

        // è¨­ç½®æœå‹™é¸æ“‡ - ä¿®å¾©é»æ“Šå•é¡Œ
        function setupServiceSelection() {
            document.querySelectorAll('.service-card').forEach(card => {
                card.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    console.log('Service selected:', this.dataset.service);
                    
                    // ç§»é™¤å…¶ä»–é¸ä¸­ç‹€æ…‹
                    document.querySelectorAll('.service-card').forEach(c => c.classList.remove('selected'));
                    
                    // è¨­ç½®ç•¶å‰é¸ä¸­
                    this.classList.add('selected');
                    selectedService = this.dataset.service;
                    
                    // æ›´æ–°æœå‹™é¡¯ç¤ºå™¨
                    updateServiceIndicator();
                    
                    // æ›´æ–°æœå‹™æ¬„ä½é¡¯ç¤º
                    updateServiceFields();
                    
                    // å»¶é²è‡ªå‹•é€²å…¥ä¸‹ä¸€é 
                    setTimeout(() => {
                        nextPage();
                    }, 800);
                });
            });
        }

        // æ›´æ–°æœå‹™é¡å‹é¡¯ç¤ºå™¨
        function updateServiceIndicator() {
            const serviceIndicator = document.getElementById('serviceIndicator');
            if (selectedService) {
                serviceIndicator.textContent = `æœå‹™é¡å‹ï¼š${selectedService}`;
                serviceIndicator.classList.add('show');
            } else {
                serviceIndicator.classList.remove('show');
            }
        }

        // è¨­ç½®æ™‚é–“é¸æ“‡å™¨
        function setupTimePicker() {
            const hourSelect = document.getElementById('hourSelect');
            const minuteSelect = document.getElementById('minuteSelect');
            
            // ç”Ÿæˆå°æ™‚é¸é … (00-23)
            for (let i = 0; i <= 23; i++) {
                const option = document.createElement('option');
                option.value = i.toString().padStart(2, '0');
                option.textContent = i.toString().padStart(2, '0');
                hourSelect.appendChild(option);
            }
            
            // ç”Ÿæˆåˆ†é˜é¸é … (æ¯5åˆ†é˜)
            for (let i = 0; i < 60; i += 5) {
                const option = document.createElement('option');
                option.value = i.toString().padStart(2, '0');
                option.textContent = i.toString().padStart(2, '0');
                minuteSelect.appendChild(option);
            }
        }

        // åˆ‡æ›æ™‚é–“é¸æ“‡å™¨é¡¯ç¤º
        function toggleTimePicker() {
            const timePicker = document.getElementById('timePicker');
            timePicker.classList.toggle('show');
        }

        // è¨­ç½®é¸æ“‡çš„æ™‚é–“
        function setTime() {
            const hourSelect = document.getElementById('hourSelect');
            const minuteSelect = document.getElementById('minuteSelect');
            const timeValue = document.getElementById('timeValue');
            const timePicker = document.getElementById('timePicker');
            
            if (hourSelect.value && minuteSelect.value) {
                const timeString = `${hourSelect.value}:${minuteSelect.value}`;
                timeValue.textContent = timeString;
                
                // å‰µå»ºéš±è—çš„time inputä¾†å­˜å„²å€¼
                let hiddenTimeInput = document.getElementById('hiddenTimeInput');
                if (!hiddenTimeInput) {
                    hiddenTimeInput = document.createElement('input');
                    hiddenTimeInput.type = 'hidden';
                    hiddenTimeInput.id = 'hiddenTimeInput';
                    hiddenTimeInput.name = 'time';
                    document.querySelector('.time-input').appendChild(hiddenTimeInput);
                }
                hiddenTimeInput.value = timeString;
                
                timePicker.classList.remove('show');
            } else {
                alert('è«‹é¸æ“‡å®Œæ•´çš„æ™‚é–“');
            }
        }

        // è¨­ç½®æ‰‹æ©Ÿè™Ÿç¢¼è¼¸å…¥åŠŸèƒ½ - ä¿®å¾©å¸¶å…¥å•é¡Œ
        function setupPhoneInput() {
            const phoneInput = document.getElementById('phone');
            const phoneError = document.getElementById('phoneError');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const userHistory = document.getElementById('userHistory');

            phoneInput.addEventListener('blur', function() {
                const phoneNumber = this.value.trim();
                
                // æ¸…é™¤ä¹‹å‰çš„ç‹€æ…‹
                phoneError.classList.add('hidden');
                userHistory.classList.add('hidden');
                
                if (phoneNumber) {
                    if (validatePhoneNumber(phoneNumber)) {
                        // æ¸…é™¤ä¹‹å‰çš„timeout
                        if (phoneQueryTimeout) {
                            clearTimeout(phoneQueryTimeout);
                        }
                        
                        // è¨­ç½®æ–°çš„æŸ¥è©¢timeout (300ms debounce)
                        phoneQueryTimeout = setTimeout(() => {
                            queryUserData(phoneNumber);
                        }, 300);
                    } else {
                        phoneError.classList.remove('hidden');
                    }
                }
            });

            // ç›£è½è¼¸å…¥è®ŠåŒ–
            phoneInput.addEventListener('input', function() {
                const phoneNumber = this.value.trim();
                if (phoneNumber.length >= 10) {
                    phoneInput.dispatchEvent(new Event('blur'));
                }
            });
        }

        // è‡ªå‹•å¡«å…¥ç”¨æˆ¶è³‡æ–™
        function autoFillUserData(record) {
            if (record.company) {
                const companyInput = document.getElementById('company');
                companyInput.value = record.company;
                companyInput.classList.add('auto-filled');
            }
            
            if (record.department) {
                const departmentInput = document.getElementById('department');
                departmentInput.value = record.department;
                departmentInput.classList.add('auto-filled');
            }
            
            if (record.name) {
                const nameInput = document.getElementById('name');
                nameInput.value = record.name;
                nameInput.classList.add('auto-filled');
            }
        }

        // å¡«å…¥æ­·å²è³‡æ–™
        function fillFormWithHistory(record) {
            autoFillUserData(record);
            
            // éš±è—æ­·å²è³‡æ–™å€å¡Š
            document.getElementById('userHistory').classList.add('hidden');
        }

        // é©—è­‰æ‰‹æ©Ÿè™Ÿç¢¼
        function validatePhoneNumber(phone) {
            // å°ç£æ‰‹æ©Ÿæ ¼å¼: 09xxxxxxxx
            if (/^09\d{8}$/.test(phone)) {
                return true;
            }
            
            // åœ‹éš›æ ¼å¼: +åœ‹ç¢¼ æˆ– 00åœ‹ç¢¼
            if (/^(\+|00)\d{1,3}\d{6,14}$/.test(phone)) {
                return true;
            }
            
            return false;
        }

        // è¨­ç½®æœ€å°æ—¥æœŸç‚ºä»Šå¤©
        function setMinDate() {
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('date');
            dateInput.min = today;
            
            // ç›£è½æ—¥æœŸè®ŠåŒ–ï¼Œç„¡éœ€é»æ“Šå®Œæˆ
            dateInput.addEventListener('change', function() {
                console.log('æ—¥æœŸå·²é¸æ“‡:', this.value);
            });
        }

        // æ›´æ–°æœå‹™æ¬„ä½é¡¯ç¤º
        function updateServiceFields() {
            const airportField = document.getElementById('airportField');
            const flightField = document.getElementById('flightField');
            
            if (selectedService === 'åŒ—åŒ—åŸºæ¡ƒé€æ©Ÿ') {
                airportField.style.display = 'block';
                flightField.style.display = 'block';
                // é è¨­ä¸‹è»Šåœ°é»ç‚ºæ©Ÿå ´
                setTimeout(() => {
                    document.getElementById('dropoff').value = getSelectedAirport();
                }, 100);
            } else if (selectedService === 'åŒ—åŒ—åŸºæ¡ƒæ¥æ©Ÿ') {
                airportField.style.display = 'block';
                flightField.style.display = 'block';
                // é è¨­ä¸Šè»Šåœ°é»ç‚ºæ©Ÿå ´
                setTimeout(() => {
                    document.getElementById('pickup').value = getSelectedAirport();
                }, 100);
            } else {
                airportField.style.display = 'none';
                flightField.style.display = 'none';
                // æ¸…ç©ºæ©Ÿå ´ç›¸é—œæ¬„ä½
                document.getElementById('pickup').value = '';
                document.getElementById('dropoff').value = '';
            }
        }

        // é é¢å°èˆª - å¢åŠ å‹•ç•«æ•ˆæœ
        function goToPage(page) {
            const currentPageElement = document.querySelector('.page.active');
            const targetPageElement = document.querySelector(`[data-page="${page}"]`);
            
            if (currentPageElement && targetPageElement) {
                // æ·»åŠ æ·¡å‡ºå‹•ç•«
                currentPageElement.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
                currentPageElement.style.opacity = '0';
                currentPageElement.style.transform = page > currentPage ? 'translateX(-30px)' : 'translateX(30px)';
                
                setTimeout(() => {
                    // éš±è—ç•¶å‰é é¢
                    currentPageElement.classList.remove('active');
                    currentPageElement.style.opacity = '';
                    currentPageElement.style.transform = '';
                    
                    // æº–å‚™ç›®æ¨™é é¢
                    targetPageElement.style.opacity = '0';
                    targetPageElement.style.transform = page > currentPage ? 'translateX(30px)' : 'translateX(-30px)';
                    targetPageElement.classList.add('active');
                    
                    // æ·»åŠ æ·¡å…¥å‹•ç•«
                    setTimeout(() => {
                        targetPageElement.style.transition = 'opacity 0.3s ease-in, transform 0.3s ease-in';
                        targetPageElement.style.opacity = '1';
                        targetPageElement.style.transform = 'translateX(0)';
                        
                        setTimeout(() => {
                            targetPageElement.style.transition = '';
                        }, 300);
                    }, 50);
                }, 300);
            }
            
            // æ›´æ–°é€²åº¦æ¢
            document.querySelectorAll('.progress-step').forEach(s => s.classList.remove('active'));
            for (let i = 1; i <= page; i++) {
                document.querySelector(`[data-step="${i}"]`).classList.add('active');
            }
            
            currentPage = page;
            
            // æ›´æ–°æœå‹™é¡å‹é¡¯ç¤ºå™¨
            updateServiceIndicator();
        }

        // ä¸‹ä¸€é 
        function nextPage() {
            if (currentPage === 1) {
                if (!selectedService) {
                    alert('è«‹é¸æ“‡æœå‹™é …ç›®');
                    return;
                }
            } else if (currentPage === 2) {
                if (!validateForm()) {
                    return;
                }
                generateSummary();
            }
            
            if (currentPage < 4) {
                goToPage(currentPage + 1);
            }
        }

        // ä¸Šä¸€é 
        function prevPage() {
            if (currentPage > 1) {
                goToPage(currentPage - 1);
            }
        }

        // é‡æ–°é–‹å§‹é ç´„
        function restartBooking() {
            if (confirm('ç¢ºå®šè¦é‡æ–°é–‹å§‹å—ï¼Ÿæ‰€æœ‰å¡«å¯«çš„è³‡æ–™å°‡æœƒæ¸…é™¤ã€‚')) {
                // é‡ç½®æ‰€æœ‰è¡¨å–®
                document.querySelectorAll('.form-input, .form-textarea').forEach(input => {
                    input.value = '';
                    input.classList.remove('auto-filled');
                });
                
                // é‡ç½®é¸é …
                document.querySelectorAll('.service-card').forEach(card => {
                    card.classList.remove('selected');
                });
                
                // é‡ç½®æ©Ÿå ´å’Œä»˜æ¬¾é¸é …
                document.querySelector('input[name="airport"][value="æ¡ƒåœ’æ©Ÿå ´"]').checked = true;
                document.querySelectorAll('input[name="payment"]').forEach(radio => {
                    radio.checked = false;
                });
                
                // é‡ç½®æ™‚é–“é¸æ“‡å™¨
                document.getElementById('timeValue').textContent = 'è«‹é¸æ“‡æ™‚é–“';
                const hiddenTimeInput = document.getElementById('hiddenTimeInput');
                if (hiddenTimeInput) {
                    hiddenTimeInput.value = '';
                }
                document.getElementById('hourSelect').value = '';
                document.getElementById('minuteSelect').value = '';
                
                // é‡ç½®è®Šæ•¸
                selectedService = '';
                userDataCache = {};
                
                // å›åˆ°ç¬¬ä¸€é 
                goToPage(1);
                
                // éš±è—æœå‹™ç›¸é—œæ¬„ä½
                const airportField = document.getElementById('airportField');
                const flightField = document.getElementById('flightField');
                if (airportField) airportField.style.display = 'none';
                if (flightField) flightField.style.display = 'none';
            }
        }

        // è¡¨å–®é©—è­‰
        function validateForm() {
            const requiredFields = ['phone', 'company', 'name', 'date', 'pickup', 'dropoff'];
            let isValid = true;

            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.style.borderColor = '#dc3545';
                    isValid = false;
                } else {
                    field.style.borderColor = '#e9ecef';
                }
            });

            // æª¢æŸ¥æ™‚é–“
            const hiddenTimeInput = document.getElementById('hiddenTimeInput');
            if (!hiddenTimeInput || !hiddenTimeInput.value) {
                document.getElementById('timeDisplay').style.borderColor = '#dc3545';
                isValid = false;
            } else {
                document.getElementById('timeDisplay').style.borderColor = '#e9ecef';
            }

            // æª¢æŸ¥ä»˜æ¬¾æ–¹å¼
            const paymentSelected = document.querySelector('input[name="payment"]:checked');
            if (!paymentSelected) {
                alert('è«‹é¸æ“‡è²»ç”¨æ”¯ä»˜æ–¹å¼');
                isValid = false;
            }

            // æª¢æŸ¥æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼
            if (!validatePhoneNumber(document.getElementById('phone').value)) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ‰‹æ©Ÿè™Ÿç¢¼');
                isValid = false;
            }

            if (!isValid) {
                alert('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½');
            }

            return isValid;
        }

        // ç”Ÿæˆé ç´„æ‘˜è¦
        function generateSummary() {
            const summaryContent = document.getElementById('summaryContent');
            const airport = getSelectedAirport();
            const flight = document.getElementById('flight').value;
            const airportInfo = flight ? `${airport} / ${flight}` : airport;
            const hiddenTimeInput = document.getElementById('hiddenTimeInput');
            const timeValue = hiddenTimeInput ? hiddenTimeInput.value : '';

            summaryContent.innerHTML = `
                <div class="summary-item">
                    <div class="summary-label">æœå‹™é …ç›®</div>
                    <div class="summary-value">${selectedService}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">å…¬å¸åç¨±</div>
                    <div class="summary-value">${document.getElementById('company').value}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">è¯çµ¡äºº</div>
                    <div class="summary-value">${document.getElementById('name').value}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">æ‰‹æ©Ÿè™Ÿç¢¼</div>
                    <div class="summary-value">${document.getElementById('phone').value}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">é ç´„æ™‚é–“</div>
                    <div class="summary-value">${document.getElementById('date').value} ${timeValue}</div>
                </div>
                ${(selectedService !== 'å…¶ä»–è¡Œç¨‹æ¥é€') ? `
                <div class="summary-item">
                    <div class="summary-label">æ©Ÿå ´è³‡è¨Š</div>
                    <div class="summary-value">${airportInfo}</div>
                </div>` : ''}
                <div class="summary-item">
                    <div class="summary-label">ä¸Šè»Šåœ°é»</div>
                    <div class="summary-value">${document.getElementById('pickup').value}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">ä¸‹è»Šåœ°é»</div>
                    <div class="summary-value">${document.getElementById('dropoff').value}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">ä»˜æ¬¾æ–¹å¼</div>
                    <div class="summary-value">${getSelectedPayment()}</div>
                </div>
            `;
        }

        // æäº¤é ç´„
        function submitBooking() {
            const hiddenTimeInput = document.getElementById('hiddenTimeInput');
            const timeValue = hiddenTimeInput ? hiddenTimeInput.value : '';
            
            const requestData = {
                action: 'createBooking',
                'æœå‹™é …ç›®': selectedService,
                'å…¬å¸åç¨±': document.getElementById('company').value,
                'éƒ¨é–€': document.getElementById('department').value,
                'æ‰‹æ©Ÿè™Ÿç¢¼': document.getElementById('phone').value,
                'å§“å': document.getElementById('name').value,
                'æ—¥æœŸ': document.getElementById('date').value,
                'æ™‚é–“': timeValue,
                'æ©Ÿå ´/èˆªç­': getSelectedAirport() + (document.getElementById('flight').value ? ' / ' + document.getElementById('flight').value : ''),
                'ä¸Šè»Šé»': document.getElementById('pickup').value,
                'ä¸‹è»Šé»': document.getElementById('dropoff').value,
                'å‚™è¨»': document.getElementById('remarks').value,
                'è²»ç”¨æ”¯ä»˜': getSelectedPayment()
            };

            console.log('ç™¼é€è«‹æ±‚:', requestData);

            const formData = new URLSearchParams();
            formData.append('data', JSON.stringify(requestData));

            fetch(CONFIG.API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: formData
            })
            .then(function(response) {
                if (!response.ok) {
                    throw new Error('HTTP error! status: ' + response.status);
                }
                return response.json();
            })
            .then(function(result) {
                console.log('API å›æ‡‰:', result);

                if (result.success) {
                    document.getElementById('bookingIdDisplay').textContent = result.data.phone;
                    goToPage(4);
                } else {
                    throw new Error(result.message || 'é ç´„å¤±æ•—');
                }
            })
            .catch(function(error) {
                console.error('æäº¤é ç´„éŒ¯èª¤:', error);
                alert('é ç´„æäº¤å¤±æ•—: ' + error.message);
            });
        }

        // è¼”åŠ©å‡½æ•¸
        function getSelectedAirport() {
            const selectedAirport = document.querySelector('input[name="airport"]:checked');
            return selectedAirport ? selectedAirport.value : 'æ¡ƒåœ’æ©Ÿå ´';
        }

        function getSelectedPayment() {
            const selectedPayment = document.querySelector('input[name="payment"]:checked');
            return selectedPayment ? selectedPayment.value : '';
        }

        function goToQuery() {
            window.location.href = 'query.html';
        }

        // æ–°å¢é ç´„ - ä¿ç•™å€‹è³‡ä½†é‡ç½®å…¶ä»–æ¬„ä½
        function newBooking() {
            // ä¿å­˜å€‹è³‡
            const savedData = {
                phone: document.getElementById('phone').value,
                company: document.getElementById('company').value,
                department: document.getElementById('department').value,
                name: document.getElementById('name').value
            };
            
            // é‡ç½®æ‰€æœ‰è¡¨å–®
            document.querySelectorAll('.form-input, .form-textarea').forEach(input => {
                if (!['phone', 'company', 'department', 'name'].includes(input.id)) {
                    input.value = '';
                }
                input.classList.remove('auto-filled');
            });
            
            // æ¢å¾©å€‹è³‡ä¸¦æ¨™è¨˜ç‚ºè‡ªå‹•å¡«å…¥
            if (savedData.phone) {
                document.getElementById('phone').value = savedData.phone;
                document.getElementById('phone').classList.add('auto-filled');
            }
            if (savedData.company) {
                document.getElementById('company').value = savedData.company;
                document.getElementById('company').classList.add('auto-filled');
            }
            if (savedData.department) {
                document.getElementById('department').value = savedData.department;
                document.getElementById('department').classList.add('auto-filled');
            }
            if (savedData.name) {
                document.getElementById('name').value = savedData.name;
                document.getElementById('name').classList.add('auto-filled');
            }
            
            // é‡ç½®é¸é …
            document.querySelectorAll('.service-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // é‡ç½®æ©Ÿå ´å’Œä»˜æ¬¾é¸é …
            document.querySelector('input[name="airport"][value="æ¡ƒåœ’æ©Ÿå ´"]').checked = true;
            document.querySelectorAll('input[name="payment"]').forEach(radio => {
                radio.checked = false;
            });
            
            // é‡ç½®æ™‚é–“é¸æ“‡å™¨
            document.getElementById('timeValue').textContent = 'è«‹é¸æ“‡æ™‚é–“';
            const hiddenTimeInput = document.getElementById('hiddenTimeInput');
            if (hiddenTimeInput) {
                hiddenTimeInput.value = '';
            }
            document.getElementById('hourSelect').value = '';
            document.getElementById('minuteSelect').value = '';
            
            // é‡ç½®è®Šæ•¸
            selectedService = '';
            
            // å›åˆ°ç¬¬ä¸€é 
            goToPage(1);
            
            // éš±è—æœå‹™ç›¸é—œæ¬„ä½
            const airportField = document.getElementById('airportField');
            const flightField = document.getElementById('flightField');
            if (airportField) airportField.style.display = 'none';
            if (flightField) flightField.style.display = 'none';
        }

        // é¡¯ç¤ºé›¢é–‹å°è©±æ¡†
        function showExitDialog() {
            const exitOverlay = document.getElementById('exitOverlay');
            exitOverlay.classList.add('show');
        }

        // éš±è—é›¢é–‹å°è©±æ¡†
        function hideExitDialog() {
            const exitOverlay = document.getElementById('exitOverlay');
            exitOverlay.classList.remove('show');
        }

        // é›¢é–‹ç³»çµ±
        function exitSystem() {
            window.close();
            // å¦‚æœç„¡æ³•é—œé–‰è¦–çª—ï¼Œå‰‡è·³è½‰åˆ°ç©ºç™½é é¢
            setTimeout(() => {
                window.location.href = 'about:blank';
            }, 100);
        }

        // ç›£è½æ©Ÿå ´é¸æ“‡è®ŠåŒ–
        document.addEventListener('change', function(e) {
            if (e.target.name === 'airport') {
                if (selectedService === 'åŒ—åŒ—åŸºæ¡ƒé€æ©Ÿ') {
                    document.getElementById('dropoff').value = getSelectedAirport();
                } else if (selectedService === 'åŒ—åŒ—åŸºæ¡ƒæ¥æ©Ÿ') {
                    document.getElementById('pickup').value = getSelectedAirport();
                }
            }
        });

        // ESCéµé—œé–‰æ™‚é–“é¸æ“‡å™¨
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.getElementById('timePicker').classList.remove('show');
                hideExitDialog();
            }
        });
        // ==========================================
// åœ¨ index.html çš„ <script> å€åŸŸæœ€åº•éƒ¨åŠ å…¥ä»¥ä¸‹ä»£ç¢¼
// é€™æœƒä¿®æ­£æ‰€æœ‰ queryUserData éŒ¯èª¤ä¸¦ç¢ºä¿åŠŸèƒ½æ­£å¸¸
// ==========================================

// ç°¡å–®ä¿®æ­£ queryUserData éŒ¯èª¤
function queryUserData() {}

// ç§»é™¤å¯èƒ½çš„éŒ¯èª¤èª¿ç”¨
if (typeof setTimeout !== 'undefined') {
    // è¦†è“‹ä»»ä½•å¯èƒ½çš„éŒ¯èª¤ setTimeout èª¿ç”¨
    var originalSetTimeout = setTimeout;
    setTimeout = function(func, delay) {
        if (typeof func === 'function') {
            try {
                return originalSetTimeout(func, delay);
            } catch (e) {
                console.log('å¿½ç•¥éŒ¯èª¤çš„ setTimeout èª¿ç”¨:', e.message);
            }
        } else if (typeof func === 'string' && func.includes('queryUserData')) {
            console.log('å¿½ç•¥èˆŠçš„ queryUserData èª¿ç”¨');
            return;
        }
        return originalSetTimeout(func, delay);
    };
}

// ç¢ºä¿æ–°çš„è‡ªå‹•å¸¶å…¥åŠŸèƒ½æ­£å¸¸é‹ä½œ
document.addEventListener('DOMContentLoaded', function() {
    // ç§»é™¤èˆŠçš„äº‹ä»¶ç›£è½å™¨
    const phoneInput = document.getElementById('phone');
    if (phoneInput) {
        // æ¸…é™¤æ‰€æœ‰ç¾æœ‰çš„äº‹ä»¶ç›£è½å™¨
        phoneInput.replaceWith(phoneInput.cloneNode(true));
        
        // é‡æ–°ç²å–å…ƒç´ ä¸¦è¨­å®šæ–°çš„äº‹ä»¶ç›£è½å™¨
        const newPhoneInput = document.getElementById('phone');
        if (newPhoneInput) {
            // è¨­å®šæ–°çš„è‡ªå‹•å¸¶å…¥åŠŸèƒ½
            newPhoneInput.addEventListener('blur', function() {
                const phone = this.value.trim();
                if (phone && phone.length >= 9) {
                    if (typeof loadUserData === 'function') {
                        loadUserData(phone);
                    }
                }
            });
            
            newPhoneInput.addEventListener('input', function() {
                const phone = this.value.trim().replace(/\D/g, '');
                if (phone.length === 10) {
                    if (typeof loadUserData === 'function') {
                        loadUserData(phone);
                    }
                }
            });
        }
    }
});

// ç¢ºä¿è¡¨å–®æäº¤æ™‚åŒ…å« email
if (typeof collectFormData !== 'undefined') {
    // å¦‚æœå·²æœ‰ collectFormData å‡½æ•¸ï¼Œç¢ºä¿åŒ…å« email
} else {
    function collectFormData() {
        return {
            action: 'createBooking',
            'æœå‹™é …ç›®': selectedService || document.getElementById('service')?.value,
            'å…¬å¸åç¨±': document.getElementById('company')?.value || '',
            'éƒ¨é–€': document.getElementById('department')?.value || '',
            'æ‰‹æ©Ÿè™Ÿç¢¼': document.getElementById('phone')?.value || '',
            'å§“å': document.getElementById('name')?.value || '',
            'é›»å­éƒµä»¶': document.getElementById('email')?.value || '',
            'æ—¥æœŸ': document.getElementById('date')?.value || '',
            'æ™‚é–“': document.getElementById('time')?.value || '',
            'æ©Ÿå ´/èˆªç­': (getSelectedAirport ? getSelectedAirport() : '') + 
                        (document.getElementById('flight')?.value ? ' / ' + document.getElementById('flight').value : ''),
            'ä¸Šè»Šé»': document.getElementById('pickup')?.value || '',
            'ä¸‹è»Šé»': document.getElementById('dropoff')?.value || '',
            'å‚™è¨»': document.getElementById('remarks')?.value || '',
            'è²»ç”¨æ”¯ä»˜': getSelectedPayment ? getSelectedPayment() : ''
        };
    }
}

console.log('index.html ä¿®æ­£å®Œæˆ - æ‰€æœ‰éŒ¯èª¤å·²ä¿®æ­£ï¼ŒGmail é€šçŸ¥ç³»çµ±å·²å•Ÿç”¨');
        // è‡ªå‹•å¸¶å…¥åŠŸèƒ½
const API_URL_FOR_AUTO = 'https://script.google.com/macros/s/AKfycbwmXgTbydw-G5-WLvE0PMBB8Qbi3Umq3yOl91a7c-Y9iiIlEhHOikLZHjDf5VS0H-4npw/exec';

// è¨­å®šæ‰‹æ©Ÿè™Ÿç¢¼è‡ªå‹•å¸¶å…¥åŠŸèƒ½
function setupPhoneAutofill() {
    const phoneInput = document.getElementById('phone');
    if (phoneInput) {
        phoneInput.addEventListener('blur', function() {
            const phone = this.value.trim();
            if (phone && phone.length >= 9) {
                loadUserData(phone);
            }
        });
        
        phoneInput.addEventListener('input', function() {
            const phone = this.value.trim().replace(/\D/g, '');
            if (phone.length === 10) {
                loadUserData(phone);
            }
        });
    }
}

// ==========================================
// è«‹åœ¨æ‚¨çš„ index.html ä¸­æ‰¾åˆ°ç¾æœ‰çš„ loadUserData å‡½æ•¸ä¸¦æ›¿æ›ç‚ºä»¥ä¸‹ä»£ç¢¼
// å¦‚æœæ²’æœ‰æ‰¾åˆ°ï¼Œè«‹åœ¨ </script> æ¨™ç±¤å‰åŠ å…¥ä»¥ä¸‹å®Œæ•´ä»£ç¢¼
// ==========================================

// æ™ºèƒ½è‡ªå‹•å¸¶å…¥åŠŸèƒ½ - æ›¿æ›ç¾æœ‰çš„ loadUserData å‡½æ•¸
// å®šç¾© API URL
const API_URL_FOR_AUTO = 'https://script.google.com/macros/s/AKfycbwmXgTbydw-G5-WLvE0PMBB8Qbi3Umq3yOl91a7c-Y9iiIlEhHOikLZHjDf5VS0H-4npw/exec';

// è¨­å®šæ‰‹æ©Ÿè™Ÿç¢¼äº‹ä»¶ç›£è½
function setupPhoneAutofill() {
    const phoneInput = document.getElementById('phone');
    if (phoneInput) {
        phoneInput.addEventListener('blur', function() {
            const phone = this.value.trim();
            if (phone && phone.length >= 9) {
                loadUserData(phone);
            }
        });
        console.log('æ‰‹æ©Ÿè™Ÿç¢¼è‡ªå‹•å¸¶å…¥å·²è¨­å®š');
    }
}                   
async function loadUserData(phone) {
    try {
        console.log('æ­£åœ¨æŸ¥è©¢æ‰‹æ©Ÿè™Ÿç¢¼:', phone);
        
        const formData = new URLSearchParams();
        formData.append('action', 'getBookingsByPhone');
        formData.append('phone', phone);

        const response = await fetch(API_URL_FOR_AUTO, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: formData
        });

        const result = await response.json();
        
        console.log('æŸ¥è©¢çµæœ:', result);
        
        if (result.success && result.bookings && result.bookings.length > 0) {
            // ç²å–ç•¶å‰é¸æ“‡çš„æœå‹™é¡å‹
            const currentService = getCurrentServiceType();
            console.log('ç•¶å‰æœå‹™é¡å‹:', currentService);
            
            // æ™ºèƒ½é¸æ“‡è¦å¡«å…¥çš„é ç´„è¨˜éŒ„
            const selectedBooking = selectBestBooking(result.bookings, currentService);
            
            if (selectedBooking) {
                fillUserDataSmart(selectedBooking);
                console.log('âœ… å·²è‡ªå‹•å¸¶å…¥åŒ¹é…çš„æœå‹™é¡å‹è³‡æ–™');
            } else {
                // åªå¡«å…¥åŸºæœ¬å€‹äººè³‡æ–™ï¼Œä¸å¡«å…¥æœå‹™ç›¸é—œè³‡æ–™
                fillUserDataBasic(result.bookings[0]);
                console.log('âœ… å·²è‡ªå‹•å¸¶å…¥åŸºæœ¬å€‹äººè³‡æ–™ï¼Œæœå‹™ç›¸é—œè³‡æ–™éœ€æ‰‹å‹•è¼¸å…¥');
            }
        } else {
            console.log('æœªæ‰¾åˆ°ç”¨æˆ¶è³‡æ–™ï¼Œè«‹æ‰‹å‹•å¡«å¯«');
        }
        
    } catch (error) {
        console.error('è¼‰å…¥ç”¨æˆ¶è³‡æ–™å¤±æ•—:', error);
    }
}

// ç²å–ç•¶å‰é¸æ“‡çš„æœå‹™é¡å‹
function getCurrentServiceType() {
    // æ–¹æ³•1ï¼šå¾å…¨åŸŸè®Šæ•¸ç²å–
    if (typeof selectedService !== 'undefined' && selectedService) {
        return selectedService;
    }
    
    // æ–¹æ³•2ï¼šå¾ select å…ƒç´ ç²å–
    const serviceSelect = document.getElementById('service');
    if (serviceSelect && serviceSelect.value) {
        return serviceSelect.value;
    }
    
    // æ–¹æ³•3ï¼šå¾é¸ä¸­çš„ radio button ç²å–
    const selectedRadio = document.querySelector('input[name="service"]:checked');
    if (selectedRadio) {
        return selectedRadio.value;
    }
    
    return null;
}

// æ™ºèƒ½é¸æ“‡æœ€ä½³é ç´„è¨˜éŒ„
function selectBestBooking(bookings, currentService) {
    if (!currentService) {
        return null; // æ²’æœ‰é¸æ“‡æœå‹™é¡å‹æ™‚ï¼Œä¸å¡«å…¥æœå‹™ç›¸é—œè³‡æ–™
    }
    
    // æœå‹™é¡å‹æ˜ å°„
    const serviceMapping = {
        'åŒ—åŒ—åŸºæ¡ƒé€æ©Ÿ': ['é€æ©Ÿ', 'åŒ—åŒ—åŸºæ¡ƒé€æ©Ÿ'],
        'åŒ—åŒ—åŸºæ¡ƒæ¥æ©Ÿ': ['æ¥æ©Ÿ', 'åŒ—åŒ—åŸºæ¡ƒæ¥æ©Ÿ'],
        'å…¶ä»–è¡Œç¨‹æ¥é€': ['å…¶ä»–', 'å…¶ä»–è¡Œç¨‹æ¥é€']
    };
    
    const targetTypes = serviceMapping[currentService] || [currentService];
    
    // æ‰¾åˆ°æœ€æ–°çš„åŒ¹é…æœå‹™é¡å‹è¨˜éŒ„
    for (let booking of bookings) {
        if (targetTypes.includes(booking.service) || targetTypes.includes(booking.serviceRaw)) {
            console.log('æ‰¾åˆ°åŒ¹é…çš„æœå‹™é¡å‹è¨˜éŒ„:', booking.service);
            return booking;
        }
    }
    
    console.log('æœªæ‰¾åˆ°åŒ¹é…çš„æœå‹™é¡å‹è¨˜éŒ„');
    return null; // æ²’æ‰¾åˆ°åŒ¹é…çš„æœå‹™é¡å‹
}

// æ™ºèƒ½å¡«å…¥ç”¨æˆ¶è³‡æ–™ (åŒ…å«æœå‹™ç›¸é—œè³‡æ–™)
function fillUserDataSmart(booking) {
    console.log('æ™ºèƒ½å¡«å…¥è³‡æ–™:', booking);
    
    // å¡«å…¥å€‹äººåŸºæœ¬è³‡æ–™
    fillUserDataBasic(booking);
    
    // å¡«å…¥æœå‹™ç›¸é—œè³‡æ–™ (æ’é™¤æ—¥æœŸã€æ™‚é–“ã€ç­æ©Ÿ)
    const departureInput = document.getElementById('pickup') || document.getElementById('departure');
    if (departureInput && booking.departure) {
        departureInput.value = booking.departure;
        console.log('å·²å¡«å…¥ä¸Šè»Šé»:', booking.departure);
    }

    const destinationInput = document.getElementById('dropoff') || document.getElementById('destination');
    if (destinationInput && booking.destination) {
        destinationInput.value = booking.destination;
        console.log('å·²å¡«å…¥ä¸‹è»Šé»:', booking.destination);
    }

    const notesInput = document.getElementById('remarks') || document.getElementById('notes');
    if (notesInput && booking.notes) {
        notesInput.value = booking.notes;
        console.log('å·²å¡«å…¥å‚™è¨»:', booking.notes);
    }

    // å¡«å…¥ä»˜æ¬¾æ–¹å¼ (radio buttons)
    const paymentInputs = document.querySelectorAll('input[name="payment"]');
    if (paymentInputs.length > 0 && booking.payment) {
        paymentInputs.forEach(input => {
            if (input.value === booking.payment) {
                input.checked = true;
                console.log('å·²é¸æ“‡ä»˜æ¬¾æ–¹å¼:', booking.payment);
            }
        });
    }
}

// åªå¡«å…¥åŸºæœ¬å€‹äººè³‡æ–™ (ä¸å¡«å…¥æœå‹™ç›¸é—œè³‡æ–™)
function fillUserDataBasic(booking) {
    console.log('å¡«å…¥åŸºæœ¬å€‹äººè³‡æ–™:', booking);
    
    const nameInput = document.getElementById('name');
    if (nameInput && booking.name) {
        nameInput.value = booking.name;
        console.log('å·²å¡«å…¥å§“å:', booking.name);
    }

    const companyInput = document.getElementById('company');
    if (companyInput && booking.company) {
        companyInput.value = booking.company;
        console.log('å·²å¡«å…¥å…¬å¸:', booking.company);
    }

    const departmentInput = document.getElementById('department');
    if (departmentInput && booking.department) {
        departmentInput.value = booking.department;
        console.log('å·²å¡«å…¥éƒ¨é–€:', booking.department);
    }

    const emailInput = document.getElementById('email');
    if (emailInput && booking.email) {
        emailInput.value = booking.email;
        console.log('å·²å¡«å…¥éƒµç®±:', booking.email);
    }
}

// æ™‚é–“é¸æ“‡è‡ªå‹•å®ŒæˆåŠŸèƒ½
function setupTimeAutoComplete() {
    // æ–¹æ³•1ï¼šé‡å°å°æ™‚å’Œåˆ†é˜çš„ select å…ƒç´ 
    const hourSelect = document.getElementById('hour');
    const minuteSelect = document.getElementById('minute');
    const timeInput = document.getElementById('time');
    
    if (hourSelect && minuteSelect) {
        function checkAndCompleteTime() {
            const hour = hourSelect.value;
            const minute = minuteSelect.value;
            
            if (hour && minute) {
                const timeValue = hour + ':' + minute;
                if (timeInput) {
                    timeInput.value = timeValue;
                }
                console.log('æ™‚é–“è‡ªå‹•å®Œæˆ:', timeValue);
                
                // è§¸ç™¼è‡ªå®šç¾©äº‹ä»¶ï¼Œé€šçŸ¥å…¶ä»–çµ„ä»¶æ™‚é–“å·²é¸æ“‡å®Œæˆ
                const event = new CustomEvent('timeSelected', { detail: { time: timeValue } });
                document.dispatchEvent(event);
            }
        }
        
        hourSelect.addEventListener('change', checkAndCompleteTime);
        minuteSelect.addEventListener('change', checkAndCompleteTime);
        
        console.log('æ™‚é–“è‡ªå‹•å®ŒæˆåŠŸèƒ½å·²è¨­å®š (select æ¨¡å¼)');
    }
    
    // æ–¹æ³•2ï¼šé‡å°å…¶ä»–å¯èƒ½çš„æ™‚é–“é¸æ“‡å…ƒç´ 
    const timePickerElements = document.querySelectorAll('[data-time-picker]');
    timePickerElements.forEach(element => {
        element.addEventListener('change', function() {
            console.log('æ™‚é–“é¸æ“‡å™¨è®Šæ›´:', this.value);
        });
    });
}

// ç¢ºä¿é é¢è¼‰å…¥æ™‚è¨­å®šæ‰€æœ‰åŠŸèƒ½
document.addEventListener('DOMContentLoaded', function() {
    setupPhoneAutofill();
    setupTimeAutoComplete();
    console.log('æ™ºèƒ½è‡ªå‹•å¸¶å…¥å’Œæ™‚é–“è‡ªå‹•å®ŒæˆåŠŸèƒ½å·²å•Ÿç”¨');
});

// å¦‚æœé é¢å·²ç¶“è¼‰å…¥å®Œæˆ
if (document.readyState !== 'loading') {
    setupPhoneAutofill();
    setupTimeAutoComplete();
    console.log('æ™ºèƒ½è‡ªå‹•å¸¶å…¥å’Œæ™‚é–“è‡ªå‹•å®ŒæˆåŠŸèƒ½å·²å•Ÿç”¨');
}

// å¡«å…¥ç”¨æˆ¶è³‡æ–™
function fillUserData(userData) {
    console.log('é–‹å§‹å¡«å…¥ç”¨æˆ¶è³‡æ–™:', userData);
    
    const nameInput = document.getElementById('name');
    if (nameInput && userData.name) {
        nameInput.value = userData.name;
        console.log('å·²å¡«å…¥å§“å:', userData.name);
    }

    const companyInput = document.getElementById('company');
    if (companyInput && userData.company) {
        companyInput.value = userData.company;
        console.log('å·²å¡«å…¥å…¬å¸:', userData.company);
    }

    const departmentInput = document.getElementById('department');
    if (departmentInput && userData.department) {
        departmentInput.value = userData.department;
        console.log('å·²å¡«å…¥éƒ¨é–€:', userData.department);
    }

    const emailInput = document.getElementById('email');
    if (emailInput && userData.email) {
        emailInput.value = userData.email;
        console.log('å·²å¡«å…¥éƒµç®±:', userData.email);
    }
}

// é é¢è¼‰å…¥æ™‚è¨­å®šåŠŸèƒ½
document.addEventListener('DOMContentLoaded', setupPhoneAutofill);
if (document.readyState !== 'loading') {
    setupPhoneAutofill();
}
    </script>
</body>
</html>










