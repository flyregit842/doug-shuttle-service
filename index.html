<!--
================================================================================
程式名稱：index.html
專案名稱：Doug Shuttle Service - B2B機場接送預約系統
版本編號：v1.1 (QA修正版)
功能說明：5步驟預約流程、智能表單自動帶入、響應式設計
測試手機號碼：0912-345-678
================================================================================
-->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doug Shuttle Service - 機場接送預約</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, sans-serif; background: #f8f9fa; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .form-container { padding: 30px; }
        .form-step { display: none; }
        .form-step.active { display: block; animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .form-label { font-size: 16px; font-weight: 600; margin-bottom: 10px; display: block; }
        .required { color: #ef4444; }
        .service-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px; }
        .service-option { padding: 25px 20px; border: 2px solid #e5e7eb; border-radius: 12px; cursor: pointer; text-align: center; transition: all 0.3s ease; }
        .service-option:hover { border-color: #667eea; background: #f8faff; }
        .service-option.selected { border-color: #667eea; background: #f0f4ff; box-shadow: 0 4px 12px rgba(102,126,234,0.15); }
        .form-control { width: 100%; padding: 14px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; }
        .form-control:focus { outline: none; border-color: #667eea; }
        .form-group { margin-bottom: 25px; }
        .form-row { display: flex; gap: 15px; }
        .form-col { flex: 1; }
        .time-selector { display: flex; gap: 10px; align-items: center; }
        .btn-group { display: flex; gap: 15px; margin-top: 30px; justify-content: center; }
        .btn { padding: 14px 28px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5a67d8; }
        .btn-outline { background: transparent; border: 2px solid #6b7280; color: #6b7280; }
        .btn-outline:hover { background: #6b7280; color: white; }
        .suggestion { background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; padding: 12px; margin-top: 10px; font-size: 14px; color: #1e40af; }
        .loading { display: none; text-align: center; padding: 20px; color: #6b7280; }
        .loading.show { display: block; }
        .spinner { width: 20px; height: 20px; border: 2px solid #e5e7eb; border-top: 2px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; display: inline-block; margin-right: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .toast { position: fixed; top: 20px; right: 20px; z-index: 10000; padding: 16px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); animation: slideInRight 0.3s ease-out; max-width: 400px; }
        .toast-error { background: #fee2e2; border: 1px solid #fecaca; color: #dc2626; }
        .toast-success { background: #dcfce7; border: 1px solid #bbf7d0; color: #16a34a; }
        .toast-info { background: #dbeafe; border: 1px solid #bfdbfe; color: #2563eb; }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @media (max-width: 768px) { .form-row { flex-direction: column; } .toast { top: 10px; right: 10px; left: 10px; max-width: none; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Doug Shuttle Service</h1>
            <p>專業機場接送服務</p>
        </div>

        <div class="form-container">
            <!-- 步驟1: 服務選擇 -->
            <div class="form-step active" id="step1">
                <label class="form-label">選擇服務項目 <span class="required">*</span></label>
                <div class="service-options">
                    <div class="service-option" data-service="送機" tabindex="0">
                        <h3>✈️ 送機服務</h3>
                        <p>住所/公司 → 機場</p>
                    </div>
                    <div class="service-option" data-service="接機" tabindex="0">
                        <h3>🏠 接機服務</h3>
                        <p>機場 → 住所/公司</p>
                    </div>
                    <div class="service-option" data-service="包車" tabindex="0">
                        <h3>🚗 包車服務</h3>
                        <p>自訂起迄點或多點行程</p>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" id="step1-next" disabled>下一步 →</button>
                </div>
            </div>

            <!-- 步驟2: 基本資訊 -->
            <div class="form-step" id="step2">
                <div class="form-group">
                    <label class="form-label" for="phone">手機號碼 <span class="required">*</span></label>
                    <input type="tel" id="phone" class="form-control" placeholder="0912-345-678">
                    <div class="loading" id="phone-loading">
                        <div class="spinner"></div>正在查詢您的歷史資料...
                    </div>
                    <div class="suggestion" id="phone-suggestion" style="display: none;">
                        ✨ 已為您帶入常用資料，可隨時修改
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label" for="name">姓名 <span class="required">*</span></label>
                            <input type="text" id="name" class="form-control" placeholder="王總">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label" for="company">公司名稱</label>
                            <input type="text" id="company" class="form-control" placeholder="ABC科技">
                        </div>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-outline" id="step2-prev">← 上一步</button>
                    <button class="btn btn-primary" id="step2-next">下一步 →</button>
                </div>
            </div>

            <!-- 步驟3: 時間安排 -->
            <div class="form-step" id="step3">
                <div class="form-group">
                    <label class="form-label" for="booking-date">服務日期 <span class="required">*</span></label>
                    <input type="date" id="booking-date" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label">預計出發時間 <span class="required">*</span></label>
                    <div class="time-selector">
                        <select id="departure-hour" class="form-control">
                            <option value="">小時</option>
                        </select>
                        <span>:</span>
                        <select id="departure-minute" class="form-control">
                            <option value="">分鐘</option>
                        </select>
                    </div>
                </div>
                <div class="suggestion">
                    💡 系統建議：送機建議航班前2-3小時出發，接機以抵達時間為準
                </div>
                <div class="btn-group">
                    <button class="btn btn-outline" id="step3-prev">← 上一步</button>
                    <button class="btn btn-primary" id="step3-next">下一步 →</button>
                </div>
            </div>

            <!-- 步驟4: 地點安排 -->
            <div class="form-step" id="step4">
                <div class="form-group">
                    <label class="form-label" for="pickup">上車地點 <span class="required">*</span></label>
                    <input type="text" id="pickup" class="form-control" placeholder="台北車站東三門">
                </div>
                <div class="form-group">
                    <label class="form-label" for="dropoff">下車地點 <span class="required">*</span></label>
                    <input type="text" id="dropoff" class="form-control" placeholder="桃園機場">
                </div>
                <div class="form-group">
                    <label class="form-label" for="remarks">備註</label>
                    <textarea id="remarks" class="form-control" rows="3" placeholder="特殊需求說明"></textarea>
                </div>
                <div class="btn-group">
                    <button class="btn btn-outline" id="step4-prev">← 上一步</button>
                    <button class="btn btn-primary" id="step4-next">下一步 →</button>
                </div>
            </div>

            <!-- 步驟5: 確認送出 -->
            <div class="form-step" id="step5">
                <h3 style="text-align: center; margin-bottom: 20px;">📋 請確認預約資訊</h3>
                <div id="confirmation-summary" style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <!-- 動態生成 -->
                </div>
                <div class="suggestion">
                    💡 司機資訊將於出發前一天以簡訊通知
                </div>
                <div class="btn-group">
                    <button class="btn btn-outline" id="step5-prev">← 返回修改</button>
                    <button class="btn btn-primary" id="step5-submit">✅ 確認預約</button>
                </div>
            </div>

            <!-- 完成頁面 -->
            <div class="form-step" id="step-complete" style="text-align: center;">
                <div style="font-size: 48px; margin-bottom: 20px;">🎉</div>
                <h2 style="color: #10b981; margin-bottom: 20px;">預約建立成功！</h2>
                <div class="suggestion">
                    📧 Email確認已發送<br>📱 司機資訊將於出發前一天通知
                </div>
                <div style="margin: 30px 0;">
                    <div class="btn-group" style="flex-direction: column; gap: 10px;">
                        <a href="query.html" class="btn btn-primary">📋 查看所有預約</a>
                        <button class="btn btn-outline" id="new-booking">🆕 建立新預約</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let formData = {};
        let selectedService = '';

        document.addEventListener('DOMContentLoaded', function() {
            initializeForm();
            bindEvents();
        });

        function initializeForm() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('booking-date').min = today;
            
            // 初始化時間選擇器
            const hourSelect = document.getElementById('departure-hour');
            const minuteSelect = document.getElementById('departure-minute');

            for (let h = 6; h <= 23; h++) {
                const hour = h.toString().padStart(2, '0');
                const option = document.createElement('option');
                option.value = hour;
                option.textContent = hour;
                hourSelect.appendChild(option);
            }

            for (let m = 0; m < 60; m += 5) {
                const minute = m.toString().padStart(2, '0');
                const option = document.createElement('option');
                option.value = minute;
                option.textContent = minute;
                minuteSelect.appendChild(option);
            }
        }

        function bindEvents() {
            // 服務選擇
            document.querySelectorAll('.service-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.service-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedService = this.dataset.service;
                    document.getElementById('step1-next').disabled = false;
                });
            });

            // 手機號碼查詢 (防抖)
            let phoneTimeout;
            document.getElementById('phone').addEventListener('input', function() {
                clearTimeout(phoneTimeout);
                const phone = this.value.replace(/\D/g, '');
                if (phone.length >= 10) {
                    phoneTimeout = setTimeout(() => simulatePhoneQuery(phone), 500);
                }
            });

            // 導航按鈕
            document.getElementById('step1-next').addEventListener('click', () => goToStep(2));
            document.getElementById('step2-prev').addEventListener('click', () => goToStep(1));
            document.getElementById('step2-next').addEventListener('click', () => goToStep(3));
            document.getElementById('step3-prev').addEventListener('click', () => goToStep(2));
            document.getElementById('step3-next').addEventListener('click', () => goToStep(4));
            document.getElementById('step4-prev').addEventListener('click', () => goToStep(3));
            document.getElementById('step4-next').addEventListener('click', () => goToStep(5));
            document.getElementById('step5-prev').addEventListener('click', () => goToStep(4));
            document.getElementById('step5-submit').addEventListener('click', submitForm);
            document.getElementById('new-booking').addEventListener('click', () => location.reload());
        }

        function simulatePhoneQuery(phone) {
            const loading = document.getElementById('phone-loading');
            const suggestion = document.getElementById('phone-suggestion');
            
            loading.classList.add('show');
            setTimeout(() => {
                loading.classList.remove('show');
                if (phone === '0912345678') {
                    document.getElementById('name').value = '王總';
                    document.getElementById('company').value = 'ABC科技';
                    suggestion.style.display = 'block';
                }
            }, 800);
        }

        function validateStep() {
            switch (currentStep) {
                case 1: return selectedService !== '';
                case 2: 
                    const phone = document.getElementById('phone').value.trim();
                    const name = document.getElementById('name').value.trim();
                    return phone && name;
                case 3:
                    const date = document.getElementById('booking-date').value;
                    const hour = document.getElementById('departure-hour').value;
                    const minute = document.getElementById('departure-minute').value;
                    return date && hour && minute;
                case 4:
                    const pickup = document.getElementById('pickup').value.trim();
                    const dropoff = document.getElementById('dropoff').value.trim();
                    return pickup && dropoff;
            }
            return true;
        }

        function goToStep(step) {
            if (!validateStep()) {
                showToast('請填寫必填欄位', 'error');
                return;
            }
            
            collectFormData();
            document.querySelector('.form-step.active').classList.remove('active');
            document.getElementById('step' + step).classList.add('active');
            
            if (step === 5) generateConfirmation();
            currentStep = step;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function collectFormData() {
            formData = {
                serviceType: selectedService,
                phone: document.getElementById('phone').value,
                name: document.getElementById('name').value,
                company: document.getElementById('company').value,
                date: document.getElementById('booking-date').value,
                hour: document.getElementById('departure-hour').value,
                minute: document.getElementById('departure-minute').value,
                pickup: document.getElementById('pickup').value,
                dropoff: document.getElementById('dropoff').value,
                remarks: document.getElementById('remarks').value
            };
        }

        function generateConfirmation() {
            const summary = document.getElementById('confirmation-summary');
            summary.innerHTML = `
                <div style="margin-bottom: 10px;"><strong>服務項目：</strong> ${formData.serviceType}</div>
                <div style="margin-bottom: 10px;"><strong>預約日期：</strong> ${formData.date}</div>
                <div style="margin-bottom: 10px;"><strong>出發時間：</strong> ${formData.hour}:${formData.minute}</div>
                <div style="margin-bottom: 10px;"><strong>上車地點：</strong> ${formData.pickup}</div>
                <div style="margin-bottom: 10px;"><strong>下車地點：</strong> ${formData.dropoff}</div>
                <div style="margin-bottom: 10px;"><strong>聯絡人：</strong> ${formData.name} (${formData.phone})</div>
                ${formData.company ? `<div style="margin-bottom: 10px;"><strong>公司：</strong> ${formData.company}</div>` : ''}
                ${formData.remarks ? `<div style="margin-bottom: 10px;"><strong>備註：</strong> ${formData.remarks}</div>` : ''}
            `;
        }

        function submitForm() {
            const btn = document.getElementById('step5-submit');
            btn.disabled = true;
            btn.innerHTML = '處理中...';
            
            setTimeout(() => {
                document.querySelector('.form-step.active').classList.remove('active');
                document.getElementById('step-complete').classList.add('active');
                showToast('預約建立成功！', 'success');
            }, 2000);
        }

        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) existingToast.remove();
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span>${type === 'error' ? '❌' : type === 'success' ? '✅' : 'ℹ️'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            setTimeout(() => {
                if (toast.parentNode) toast.remove();
            }, 3000);
        }
    </script>
</body>
</html>
